<!DOCTYPE html>
<html>
<head>
    <title>זהה מספר</title>
    <script type="text/javascript" charset="utf-8" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova-2.1.0.js"></script>
    <link href="css/mc.css" rel="stylesheet">
    <link href="fortawesome/css/font-awesome.css" rel="stylesheet">
</head>
<body>
    <div style="text-align:center;" class="view font">
		<span id="playButton" class="button-two selected"><i class="icon-play"></i></span>
		<div><span id="op1" class="button-three">1</span><span id="op2" class="button-three">2</span></div>
		<div><span id="op3" class="button-three">3</span><span id="op4" class="button-three">4</span></div>
	</div>
	<div class="random">
    <i class="icon-random"></i>
	</div>
<audio id="play" autoplay="autoplay">
</audio>
<audio id="feedback" autoplay="autoplay">
</audio>
<script type="text/javascript">
    var isSmartPhone = navigator.userAgent.match(/(Android)/); // (/(iPhone|iPod|iPad|Android|BlackBerry)/);
	var curNumber;
	var localeSuffix = '_iw.mp3';
    var media, isAudioPlay = false;
    var isAlreadyListened = false;
	$("#playButton").click(function(e) {
        if (isAudioPlay) {
            return;
        }
        isAudioPlay = true;
        $(this).removeClass('selected');
        if (isSmartPhone) {
            // TODO: adjust to iPhone...
            media = new Media('/android_asset/www/sounds/'+curNumber+localeSuffix, stopPlayAudio);
            media.play();
        } else {
            $("audio#play").attr("src", 'sounds/'+curNumber+localeSuffix);
        }
	})
	$("span[id^='op']").click(function(e) {
        if (isAudioPlay || !isAlreadyListened) {
            return;
        }
		// click on an answer
		var answer = $(this).text();
		$("span[id^='op']").removeClass("selected");
		$(this).addClass("selected");
		var feedback = (answer == curNumber)? "excellent": "tryAgain";
        if (isSmartPhone) {
            // TODO: adjust to iPhone...
            media = new Media('/android_asset/www/sounds/'+feedback+localeSuffix, stopAudio);
            media.play();
        } else {
            $("audio#play").attr("src", 'sounds/'+feedback+localeSuffix);
        }
	})
	$("i.icon-random").click(function(e) {
        // remove previous styling
        $("span[id^='op']").removeClass("rightAnswer");
        $("span[id^='op']").removeClass("selected");
        curNumber = Math.floor(Math.random()*10);
        var currentAnswers = [curNumber];

        // random position of right answer
        var currIndex = Math.ceil(Math.random()*4);
        for(var i=1; i<=4; i++) {
            if (currIndex != i) {
                var newNumber = Math.floor(Math.random()*10);
                while (currentAnswers.indexOf(newNumber) != -1) {
                    newNumber = Math.floor(Math.random()*10);
                }
                currentAnswers.push(newNumber);
            }
            $("span#op"+i).text((currIndex == i)?curNumber:newNumber);
            if(currIndex == i) {
                $("span#op"+i).addClass("rightAnswer");
            }
        }
        $("span[id^='op']").removeClass("button-two").addClass("button-three");
        isAlreadyListened = false;
    });
    $("audio#play").on("ended", function() {
        stopPlayAudio(true);
    })
    function stopPlayAudio(isDesktop) {
        stopAudio(true);
        // change the play button to active
        $("#playButton").addClass("selected");
        if (!isAlreadyListened) {
            isAlreadyListened = true;
            // change the buttons to active
            $("span[id^='op']").removeClass("button-three").addClass("button-two");
        }
    }
    function stopAudio(isDesktop) {
        if (!isDesktop) {
            media.stop();
            media = null;
        }
        isAudioPlay = false;
    }

    $("i.icon-random").click();
</script>
</body>
</html>